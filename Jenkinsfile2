
def stagesCommuns = [
    'Configuration',
    'Tests communs'
]

def stagesSpecifiquesA = [
    'Etapes spécifiques pour A'
]

def stagesSpecifiquesB = [
    'Etapes spécifiques pour B'
]

def stagesSpecifiquesC = [
    'Etapes spécifiques pour C'
]

pipeline {
    agent any

  

    stages {
        script {
            // Ajouter les étapes communes indépendamment du couloir choisi
            for (stageName in stagesCommuns) {
                stage(stageName) {
                    echo "Exécution de l'étape commune: ${stageName}"
                    // Ajouter des étapes communes ici
                }
            }
        }

        script {
            // Ajouter les étapes spécifiques au couloir choisi
            switch(COULOIR) {
                case 'A':
                    for (stageName in stagesSpecifiquesA) {
                        build(stageName)
                    }
                    break
                case 'B':
                    for (stageName in stagesSpecifiquesB) {
                        build(stageName)
                    }
                    break
                case 'C':
                    for (stageName in stagesSpecifiquesC) {
                        build(stageName)
                    }
                    break
                default:
                    error "Couloir inconnu: ${COULOIR}"
            }
        }
    }

    post {
        failure {
            echo "Échec dans le couloir ${COULOIR}. Veuillez vérifier les rapports et logs."
        }
        success {
            echo "Les tests ont réussi dans le couloir ${COULOIR}. La construction est prête pour la validation manuelle."
        }
    }
}
